<%= content_for(:title) { "Dashboard | #{ Current.settings["site_name"] } admin" } %>

<div>
  <h1 class="mb-8">Dashboard</h1>

  <div class="mb-4">
    <%= link_to "Cache Management", admin_cache_path, class: "btn" %>
  </div>
  <h2 class="text-xl">Pendapatan</h2>

  <div class="grid mb-8">
    <article class="mb-0 mb-4-on-tablet-and-up">
      <h2>
        <%= idr(@total_earnings, text: false) %>

        <% if @today_earnings.positive? %>
          <span class="text-green text-xs">+<%= idr(@today_earnings, text: false) %> hari ini</span>
        <% end %>
      </h2>

      <span>total pendapatan</span>
    </article>

    <article>
      <h2>
        <%= idr(@onhold_earnings, text: false) %>

        <% if @today_onhold_earnings.positive? %>
          <span class="text-green text-xs">+<%= idr(@today_onhold_earnings, text: false) %> hari ini</span>
        <% end %>
      </h2>

      <span>pendapatan on hold</span>
    </article>
  </div>

  <h2 class="text-xl">Pesanan</h2>
  <article>
    <h2>
      <%= @total_order %>

      <% if @today_total_order.positive? %>
        <span class="text-green text-xs">+<%= @today_total_order %> hari ini</span>
      <% end %>
    </h2>

    <span>total order</span>
  </article>

  <div class="grid">
    <article class="mb-0">
      <h2>
        <%= @completed_order %>

        <% if @today_completed_order.positive? %>
          <span class="text-green text-xs">+<%= @today_completed_order %> hari ini</span>
        <% end %>
      </h2>

      <span>order selesai</span>
    </article>

    <article class="mb-0">
      <h2>
        <%= @pending_order %>

        <% if @today_pending_order.positive? %>
          <span class="text-green text-xs">+<%= @today_pending_order %> hari ini</span>
        <% end %>
      </h2>

      <span>order belum dibayar</span>
    </article>

    <article class="mb-0">
      <h2>
        <%= @expired_order %>

        <% if @today_expired_order.positive? %>
          <span class="text-green text-xs">+<%= @today_expired_order %> hari ini</span>
        <% end %>
      </h2>

      <span>order kadaluarsa</span>
    </article>
   </div>

   <h2 class="text-xl">Kupon</h2>
   <div class="grid">
     <article class="mb-0">
       <h2>
         <%= @total_coupons %>

         <% if @today_created_coupons.positive? %>
           <span class="text-green text-xs">+<%= @today_created_coupons %> hari ini</span>
         <% end %>
       </h2>

       <span>total kupon</span>
     </article>

     <article class="mb-0">
       <h2>
         <%= @active_coupons %>

         <% if @today_activated_coupons.positive? %>
           <span class="text-green text-xs">+<%= @today_activated_coupons %> hari ini</span>
         <% end %>
       </h2>

       <span>kupon aktif</span>
     </article>

     <article class="mb-0">
       <h2>
         <%= @total_coupon_usage %>

         <% if @today_coupon_usage.positive? %>
           <span class="text-green text-xs">+<%= @today_coupon_usage %> hari ini</span>
         <% end %>
       </h2>

       <span>total penggunaan kupon</span>
     </article>

     <article>
       <h2>
         <%= idr(@total_discount_given, text: false) %>

         <% if @today_discount_given.positive? %>
           <span class="text-green text-xs">+<%= idr(@today_discount_given, text: false) %> hari ini</span>
         <% end %>
       </h2>

       <span>total diskon diberikan</span>
     </article>
    </div>

    <div class="mb-4 mt-8">
      <%= link_to "Export Kupon", export_admin_coupons_path, class: "btn" %>
      <%= link_to "Kelola Kupon", admin_coupons_path, class: "btn" %>
    </div>

    <div class="mb-4 mt-8">
      <h2 class="text-xl mb-4">Statistik Kupon</h2>

     <div class="grid mb-8">
       <article class="mb-0">
         <h2>Penggunaan Kupon (30 Hari Terakhir)</h2>
         <div class="coupon-usage-chart" data-controller="coupon-chart">
           <%= tag.canvas nil, data: { chart_data: @coupon_usage_chart_data.to_json } %>
         </div>
       </article>

       <article class="mb-0">
         <h2>Kupon Terpopuler</h2>
         <table class="table">
           <thead>
             <tr>
               <th>Kode</th>
               <th>Tipe</th>
               <th>Penggunaan</th>
               <th>Total Diskon</th>
             </tr>
           </thead>
           <tbody>
             <% if @top_coupons.any? %>
               <% @top_coupons.each do |coupon| %>
                 <tr>
                   <td><code><%= coupon["code"] %></code></td>
                   <td><%= coupon["discount_type"].humanize %></td>
                   <td><%= coupon["usage_count"] %></td>
                   <td><%= idr(coupon["total_discount"]) %></td>
                 </tr>
               <% end %>
             <% else %>
               <tr>
                 <td colspan="4">Belum ada penggunaan kupon</td>
               </tr>
             <% end %>
           </tbody>
         </table>
       </article>
     </div>
   </div>

   <div class="mb-4 mt-8">
     <%= link_to "Lihat Laporan Kupon", "#", class: "btn" %>
   </div>

   <h2 class="text-xl">Produk</h2>
  <table>
    <thead>
      <tr>
        <td>ID</td>
        <td>Nama</td>
        <td>Terjual</td>
      </tr>
    </thead>

    <tbody>
      <% @products.each do |product| %>
        <tr>
          <td><%= product.id %></td>
          <td><%= link_to product.name, product_path(product.slug), target: "_blank" %></td>
          <td><%= product.completed_orders.count %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
