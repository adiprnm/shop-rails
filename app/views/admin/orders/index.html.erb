<%= content_for(:title) { "Pesanan | #{ Current.settings["site_name"] } admin" } %>

<div>
  <%= tag.div flash[:notice], class: "flash-success mb-4" if flash[:notice] %>

  <h1>Pesanan</h1>

  <p class="mb-2">Produk</p>
  <%= form_with url: admin_orders_path, method: :get, data: { controller: "auto-submit" } do |f| %>
    <%= f.select :product_id,
      Product.all.collect { |p| [ p.name, p.id ] },
      {
        include_blank: "Pilih produk...",
        selected: params[:product_id]
      },
      data: { action: "auto-submit#perform" } %>
  <% end %>

  <div class="full-width overflow-x-scroll mt-8">
    <table style="min-width: 500px;">
      <thead>
        <th>ID</th>
        <th>Tanggal</th>
        <th>Nama</th>
        <th>Total Harga</th>
        <th>Status</th>
        <th>Aksi</th>
      </thead>
      <tbody>
        <% @orders.each do |order| %>
          <tr>
            <td><%= order.id %></td>
            <td><%= order.created_at.strftime("%b %d, %Y") %></td>
            <td><%= link_to order.customer_name, admin_order_path(order) %></td>
            <td><%= idr order.total_price %></td>
            <td><%= order.state %></td>
            <td>
              <%= link_to "Edit", edit_admin_order_path(order) %>
              <%= link_to "Hapus", admin_order_path(order), class: "text-red", data: { turbo_method: :delete, turbo_confirm: "Kamu yakin?" } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @pagination.has_next_page || @pagination.has_previous_page %>
    <nav class="flex justify-end gap-4 mt-4">
      <% if @pagination.has_previous_page %>
        <%= link_to "← Previous", admin_orders_path(page: @pagination.previous_page) %>
      <% else %>
        <span class="text-gray">← Previous</span>
      <% end %>

      <% if @pagination.has_next_page %>
        <%= link_to "Next →", admin_orders_path(page: @pagination.next_page) %>
      <% else %>
        <span class="text-gray">Next →</span>
      <% end %>
    </nav>
  <% end %>
</div>
