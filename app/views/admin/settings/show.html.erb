<%= content_for(:title) { "Pengaturan | #{ Current.settings["site_name"] } admin" } %>

<div>
  <%= tag.div flash[:notice], class: "flash-success mb-4" if flash[:notice] %>

  <h1>Pengaturan</h1>

  <%= form_with url: admin_settings_path, method: :put, data: { controller: "settings-origin" } do |f| %>
    <h3>Situs</h3>

    <div class="form-group">
      <%= f.label :site_name, "Nama Situs" %>
      <%= f.text_field :site_name, value: Current.settings["site_name"] %>
    </div>

    <div class="form-group" data-controller="image-preview">
      <%= f.label :site_favicon, "Favicon" %>
      <%= image_tag Current.settings["site_favicon"].present? ? request.base_url + Current.settings["site_favicon"] : "", data: { image_preview_target: "preview" }, class: "icon-xlarge block" %>
      <%= f.file_field :site_favicon, data: { action: "image-preview#perform" } %>
    </div>

    <div class="form-group">
      <%= f.label :site_storage_host, "Host Storage" %>
      <%= f.text_field :site_storage_host, value: Current.settings["site_storage_host"] %>
    </div>

    <div class="form-group">
      <%= f.label :site_terms_and_conditions_url, "URL halaman Syarat dan Ketentuan" %>
      <%= f.text_field :site_terms_and_conditions_url, value: Current.settings["site_terms_and_conditions_url"].presence || "/syarat-dan-ketentuan" %>
    </div>

    <div class="form-group" data-controller="image-preview">
      <%= f.label :og_image, "Open Graph Image" %>
      <%= image_tag Current.settings["og_image"].present? ? request.base_url + Current.settings["og_image"] : "", data: { image_preview_target: "preview" } %>
      <%= f.file_field :og_image, data: { action: "image-preview#perform" } %>
    </div>

    <div class="form-group">
      <%= f.label :site_main_menu, "Menu Utama" %>
      <%= f.text_area :site_main_menu, style: "min-height: 40px; font-family: monospace", value: Current.settings["site_main_menu"] %>
    </div>

    <div class="form-group">
      <%= f.label :payment_provider, "Provider Pembayaran" %>
      <%= f.select :payment_provider, [ [ "Midtrans", "midtrans" ], [ "Manual", "manual" ] ], { selected: Current.settings["payment_provider"] } %>
    </div>

    <h3>QRIS dan Nomor Rekening</h1>

    <div class="form-group" data-controller="image-preview">
      <%= f.label :payment_qris, "QRIS" %>
      <%= image_tag Current.settings["payment_qris"].present? ? request.base_url + Current.settings["payment_qris"] : "", data: { image_preview_target: "preview" }, class: "block" %>
      <%= f.file_field :payment_qris, data: { action: "image-preview#perform" } %>
    </div>

    <div class="form-group">
      <%= f.label :payment_account_name, "Nama Bank/E-wallet" %>
      <%= f.text_field :payment_account_name, value: Current.settings["payment_account_name"].presence %>
    </div>

    <div class="form-group">
      <%= f.label :payment_account_number, "Nomor Rekening Bank/E-wallet" %>
      <%= f.text_field :payment_account_number, value: Current.settings["payment_account_number"].presence %>
    </div>

    <div class="form-group">
      <%= f.label :payment_account_user_name, "Nama Pemilik Rekening/E-wallet" %>
      <%= f.text_field :payment_account_user_name, value: Current.settings["payment_account_user_name"].presence %>
    </div>

    <h3>Integrasi Midtrans</h3>

    <div class="form-group">
      <%= f.label :payment_api_host, "API Host" %>
      <%= f.text_field :payment_api_host, value: Current.settings["payment_api_host"] %>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :payment_client_id, "Client ID" %>
        <%= f.text_field :payment_client_id, value: Current.settings["payment_client_id"] %>
      </div>

      <div class="form-group">
        <%= f.label :payment_client_secret, "Client Secret" %>
        <%= f.text_field :payment_client_secret, value: Current.settings["payment_client_secret"] %>
      </div>
    </div>

    <h3>Email SMTP</h3>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :email_sender_name, "Nama Pengirim" %>
        <%= f.text_field :email_sender_name, value: Current.settings["email_sender_name"] %>
      </div>

      <div class="form-group">
        <%= f.label :email_sender_email, "Email Pengirim" %>
        <%= f.text_field :email_sender_email, value: Current.settings["email_sender_email"] %>
      </div>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :smtp_host, "Host" %>
        <%= f.text_field :smtp_host, value: Current.settings["smtp_host"] %>
      </div>

      <div class="form-group">
        <%= f.label :smtp_port, "Port" %>
        <%= f.text_field :smtp_port, value: Current.settings["smtp_port"] %>
      </div>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :smtp_username, "Username" %>
        <%= f.text_field :smtp_username, value: Current.settings["smtp_username"] %>
      </div>

      <div class="form-group">
        <%= f.label :smtp_password, "Password" %>
        <%= f.text_field :smtp_password, value: Current.settings["smtp_password"] %>
      </div>
    </div>

    <h3>RajaOngkir API</h3>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :rajaongkir_api_key, "API Key" %>
        <%= f.text_field :rajaongkir_api_key, value: Current.settings["rajaongkir_api_key"] %>
      </div>

      <div class="form-group">
        <%= f.label :rajaongkir_api_host, "API Host" %>
        <%= f.text_field :rajaongkir_api_host, value: Current.settings["rajaongkir_api_host"] %>
      </div>
    </div>

    <h3>Lokasi Asal Pengiriman (Default)</h3>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :default_origin_province_id, "Provinsi" %>
        <%= f.select :default_origin_province_id,
          options_for_select(Province.all.map { |p| [p.name, p.id] }, selected: Current.settings["default_origin_province_id"]),
          { include_blank: "Pilih Provinsi" },
          data: { settings_origin_target: "provinceSelect", action: "change->settings-origin#onProvinceChange" }
        %>
      </div>

      <div class="form-group">
        <%= f.label :default_origin_city_id, "Kota/Kabupaten" %>
        <%= f.select :default_origin_city_id,
          options_for_select(
            if Current.settings["default_origin_province_id"].present?
              Province.find_by(id: Current.settings["default_origin_province_id"])&.cities&.map { |c| [c.name, c.id] } || []
            else
              []
            end,
            selected: Current.settings["default_origin_city_id"]
          ),
          { include_blank: "Pilih Kota/Kabupaten" },
          data: { settings_origin_target: "citySelect", action: "change->settings-origin#onCityChange" }
        %>
      </div>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :default_origin_district_id, "Kecamatan" %>
        <%= f.select :default_origin_district_id,
          options_for_select(
            if Current.settings["default_origin_city_id"].present?
              City.find_by(id: Current.settings["default_origin_city_id"])?.districts&.map { |d| [d.name, d.id] } || []
            else
              []
            end,
            selected: Current.settings["default_origin_district_id"]
          ),
          { include_blank: "Pilih Kecamatan" },
          data: { settings_origin_target: "districtSelect", action: "change->settings-origin#onDistrictChange" }
        %>
      </div>

      <div class="form-group">
        <%= f.label :default_origin_subdistrict_id, "Kelurahan" %>
        <%= f.select :default_origin_subdistrict_id,
          options_for_select(
            if Current.settings["default_origin_district_id"].present?
              District.find_by(id: Current.settings["default_origin_district_id"])?.subdistricts&.map { |s| [s.name, s.id] } || []
            else
              []
            end,
            selected: Current.settings["default_origin_subdistrict_id"]
          ),
          { include_blank: "Pilih Kelurahan" },
          data: { settings_origin_target: "subdistrictSelect" }
        %>
      </div>
    </div>
      <div class="form-group">
        <%= f.label :email_sender_email, "Email Pengirim" %>
        <%= f.text_field :email_sender_email, value: Current.settings["email_sender_email"] %>
      </div>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :smtp_host, "Host" %>
        <%= f.text_field :smtp_host, value: Current.settings["smtp_host"] %>
      </div>

      <div class="form-group">
        <%= f.label :smtp_port, "Port" %>
        <%= f.text_field :smtp_port, value: Current.settings["smtp_port"] %>
      </div>
    </div>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :smtp_username, "Username" %>
        <%= f.text_field :smtp_username, value: Current.settings["smtp_username"] %>
      </div>

      <div class="form-group">
        <%= f.label :smtp_password, "Password" %>
        <%= f.text_field :smtp_password, value: Current.settings["smtp_password"] %>
      </div>
    </div>

    <h3>Akun Admin</h3>

    <div class="grouped">
      <div class="form-group">
        <%= f.label :admin_username, "Username" %>
        <%= f.text_field :admin_username, value: Current.settings["admin_username"] %>
      </div>

      <div class="form-group">
        <%= f.label :admin_password, "Password" %>
        <%= f.text_field :admin_password, value: Current.settings["admin_password"] %>
      </div>
    </div>

    <div class="form-group">
      <%= f.label :admin_email, "Email" %>
      <%= f.email_field :admin_email, value: Current.settings["admin_email"] %>
    </div>

    <%= f.submit "Simpan", class: "mt-4" %>
  <% end %>
</div>
